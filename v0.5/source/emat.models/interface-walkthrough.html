

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Writing and Using a Bespoke Model Interface &mdash; TMIP-EMAT 0.5.0, November 2020 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/tmip_emat.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/jupyter-sphinx.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/thebelab.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/thebelab-helper.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> TMIP-EMAT
          

          
          </a>

          
            
            
              <div class="version">
                0.5.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../emat.intro.html">Introduction to EMAT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../emat.install.html">Installation and Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../emat.scope/index.html">Exploratory Scoping</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">Core Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../emat.metamodels/index.html">Meta Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../emat.database/index.html">Databases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../emat.analysis/index.html">Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../emat.examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../emat.glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../emat.references.html">References</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">TMIP-EMAT</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Writing and Using a Bespoke Model Interface</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/source/emat.models/interface-walkthrough.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Writing-and-Using-a-Bespoke-Model-Interface">
<h1>Writing and Using a Bespoke Model Interface<a class="headerlink" href="#Writing-and-Using-a-Bespoke-Model-Interface" title="Permalink to this headline">¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">emat</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">gzip</span>
<span class="kn">from</span> <span class="nn">emat.util.show_dir</span> <span class="kn">import</span> <span class="n">show_dir</span><span class="p">,</span> <span class="n">show_file_contents</span>
</pre></div>
</div>
</div>
<p>This notebook is meant to illustrate the use of TMIP-EMAT’s various modes of operation. It provides an illustration of how to use TMIP-EMAT and the demo interface to run the command line version of the <a class="reference external" href="https://tmip-emat.github.io/source/emat.examples/RoadTest/road_test_yaml.html">Road Test</a> model. A similar approach can be developed to run any transportation model that can be run from the command line, including for proprietary modeling tools that are typically run from a graphical user
interface (GUI) but that provide command line access also.</p>
<p>In this example notebook, we will activate some logging features. The same logging utility is written directly into the EMAT and the <code class="docutils literal notranslate"><span class="pre">core_files_demo.py</span></code> module. This will give us a view of what’s happening inside the code as it runs.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">emat.util.loggers</span> <span class="kn">import</span> <span class="n">log_to_stderr</span>
<span class="n">log</span> <span class="o">=</span> <span class="n">log_to_stderr</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Connecting-to-the-Model">
<h2>Connecting to the Model<a class="headerlink" href="#Connecting-to-the-Model" title="Permalink to this headline">¶</a></h2>
<p>The interface for this model is located in the <code class="docutils literal notranslate"><span class="pre">core_files_demo.py</span></code> module, which we will import into this notebook. This file is extensively documented in comments, and is a great starting point for new users who want to write an interface for a new bespoke travel demand model.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">core_files_demo</span>
</pre></div>
</div>
</div>
<p>Within this module, you will find a definition for the <code class="docutils literal notranslate"><span class="pre">RoadTestFileModel</span></code> class.</p>
<p>We initialize an instance of the model interface object. If you look at the module code, you’ll note the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> function does a number of things, including creating a temporary directory to work in, copying the needed files into this temporary directory, loading the scope, and creating a SQLite database to work within. For your implementation, you might or might not do any of these steps. In particular, you’ll probably want to use a database that is not in a temporary location, so that the
results will be available after this notebook is closed.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fx</span> <span class="o">=</span> <span class="n">core_files_demo</span><span class="o">.</span><span class="n">RoadTestFileModel</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
[00:02.89] MainProcess/WARNING: changing cwd to /var/folders/js/bk_dt9015j79_f6bxnc44dsr0000gp/T/tmptek60l8k
[00:02.92] MainProcess/INFO: running script scope.sql
[00:02.93] MainProcess/INFO: running script exp_design.sql
[00:02.94] MainProcess/INFO: running script meta_model.sql
</pre></div></div>
</div>
<p>Once we have loaded the <code class="docutils literal notranslate"><span class="pre">RoadTestFileModel</span></code> class, we have a number of files available in the “master_directory” that was created as that temporary directory:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_dir</span><span class="p">(</span><span class="n">fx</span><span class="o">.</span><span class="n">master_directory</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
tmptek60l8k/
├── road-test-demo.db
├── road-test-files/
│   ├── demo-inputs-l.yml
│   └── demo-inputs-x.yml.template
├── road-test-model-config.yml
└── road-test-scope.yml
</pre></div></div>
</div>
</div>
<div class="section" id="Understanding-Directories">
<h2>Understanding Directories<a class="headerlink" href="#Understanding-Directories" title="Permalink to this headline">¶</a></h2>
<p>The TMIP-EMAT interface design for files-based bespoke models uses pointers for several directories to control the operation of the model.</p>
<ul>
<li><div class="first line-block">
<div class="line"><strong>local_directory</strong></div>
<div class="line">This is the working directory for this instance of TMIP-EMAT, not that for the core model itself. Typically it can be Python’s usual current working directory, accessible via <code class="docutils literal notranslate"><span class="pre">os.getcwd()</span></code>. In this directory typically you’ll have a TMIP-EMAT model configuration <em>yaml</em> file, a scope definition <em>yaml</em> file, and a sub-directory containing the files needed to run the core model itself.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>model_path</strong></div>
<div class="line">The relative path from the <code class="docutils literal notranslate"><span class="pre">local_directory</span></code> to the directory where the core model files are located. When the core model itself is actually run, this should be to the “current working directory” for that run. The <code class="docutils literal notranslate"><span class="pre">model_path</span></code> must be given in the model config <em>yaml</em> file.</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>rel_output_path</strong></div>
<div class="line">The relative path from the <code class="docutils literal notranslate"><span class="pre">model_path</span></code> to the directory where the core model output files are located. The default value of this path is “./Outputs” but this can be overridden by setting <code class="docutils literal notranslate"><span class="pre">rel_output_path</span></code> in the model config <em>yaml</em> file. If the outputs are comingled with other input files in the core model directory, this can be set to “.” (just a dot).</div>
</div>
</li>
<li><div class="first line-block">
<div class="line"><strong>archive_path</strong></div>
<div class="line">The path where model archive directories can be found. This path must be given in the model config <em>yaml</em> file. It can be given as an absolute path, or a relative path. If it is a relative path, it should be relative to the <code class="docutils literal notranslate"><span class="pre">local_directory</span></code>.</div>
</div>
</li>
</ul>
<p>These directories, especially the ones other than the <code class="docutils literal notranslate"><span class="pre">local_directory</span></code>, are defined in a model configuration <em>yaml</em> file. This makes it easy to change the directory pointers when moving TMIP-EMAT between different machines that may have different file system structures.</p>
</div>
<div class="section" id="Single-Run-Operation-for-Development-and-Debugging">
<h2>Single Run Operation for Development and Debugging<a class="headerlink" href="#Single-Run-Operation-for-Development-and-Debugging" title="Permalink to this headline">¶</a></h2>
<p>Before we take on the task of running this model in exploratory mode, we’ll want to make sure that our interface code is working correctly. To check each of the components of the interface (setup, run, post-process, load-measures, and archive), we can run each individually in sequence, and inspect the results to make sure they are correct.</p>
<div class="section" id="setup">
<h3>setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h3>
<p>This method is the place where the core model <em>set up</em> takes place, including creating or modifying files as necessary to prepare for a core model run. When running experiments, this method is called once for each core model experiment, where each experiment is defined by a set of particular values for both the exogenous uncertainties and the policy levers. These values are passed to the experiment only here, and not in the <code class="docutils literal notranslate"><span class="pre">run</span></code> method itself. This facilitates debugging, as the <code class="docutils literal notranslate"><span class="pre">setup</span></code>
method can be used without the <code class="docutils literal notranslate"><span class="pre">run</span></code> method, as we do here. This allows us to manually inspect the prepared files and ensure they are correct before actually running a potentially expensive model.</p>
<p>Each input exogenous uncertainty or policy lever can potentially be used to manipulate multiple different aspects of the underlying core model. For example, a policy lever that includes a number of discrete future network “build” options might trigger the replacement of multiple related network definition files. Or, a single uncertainty relating to the cost of fuel might scale both a parameter linked to the modeled per-mile cost of operating an automobile and the modeled total cost of fuel used
by transit services.</p>
<p>For this demo model, running the core model itself in files mode requires two configuration files to be available, one for levers and another for uncertainties. These two files are provided in the demo in two ways: as a runnable base file (for the levers) and as a template file (for the uncertainties).</p>
<p>The levers file is a <em>ready-to-use</em> file (for this demo, in YAML format, although your model may use a different file format for input files). It has default values pre-coded into the file, and to modify this file for use by EMAT the <code class="docutils literal notranslate"><span class="pre">setup</span></code> method needs to parse and edit this file to swap out the default values for new ones in each experiment. This can be done using regular expressions (as in this demo), or any other method you like to edit the file appropriately. The advantage of this
approach is that the base file is ready to use with the core model as-is, facilitating the use of this file outside the EMAT context.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_file_contents</span><span class="p">(</span><span class="n">fx</span><span class="o">.</span><span class="n">master_directory</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;road-test-files&#39;</span><span class="p">,</span> <span class="s1">&#39;demo-inputs-l.yml&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
---
# This file defines lever values for the files-based
# Road Test example.  It is intentionally a complex way
# to implement this Python-based model, designed to
# demonstrate how to use a files-based model called
# from the command line.
expand_capacity: 10
amortization_period: 30
interest_rate_lock: False
debt_type: GO Bond
lane_width: 10
mandatory_unused_lever: 42
...
</pre></div></div>
</div>
<p>By contrast, the uncertainties file is in a <em>template</em> format. The values of the parameters that will be manipulated by EMAT for each experiment are not given by default values, but instead each value to be set is indicated in the file by a unique token that is easy to search and replace, and definitely not something that appear in any script otherwise. This approach makes the text-substitution code that is used in this module much simpler and less prone to bugs. But there is a small downside of
this approach: every parameter must definitely be replaced in this process, as the template file is unusable outside the EMAT context, and also every unique token needs to be replaced.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_file_contents</span><span class="p">(</span><span class="n">fx</span><span class="o">.</span><span class="n">master_directory</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;road-test-files&#39;</span><span class="p">,</span> <span class="s1">&#39;demo-inputs-x.yml.template&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
---
# This file defines uncertainty values for the files-based
# Road Test example.  It is intentionally a complex way
# to implement this Python-based model, designed to
# demonstrate how to use a files-based model called
# from the command line.
alpha: __EMAT_PROVIDES_VALUE__ALPHA__
beta: __EMAT_PROVIDES_VALUE__BETA__
input_flow: __EMAT_PROVIDES_VALUE__INPUT_FLOW__
value_of_time: __EMAT_PROVIDES_VALUE__VALUE_OF_TIME__
labor_unit_cost_expansion: __EMAT_PROVIDES_VALUE__LABOR_UNIT_COST_EXPANSION__
materials_unit_cost_expansion: __EMAT_PROVIDES_VALUE__MATERIALS_UNIT_COST_EXPANSION__
interest_rate: __EMAT_PROVIDES_VALUE__INTEREST_RATE__
yield_curve: __EMAT_PROVIDES_VALUE__YIELD_CURVE__
...
</pre></div></div>
</div>
<p>Regardless of which file management system you use, the <code class="docutils literal notranslate"><span class="pre">setup</span></code> method is the place to make edits to these input files and write them into your working directory. To do so, the <code class="docutils literal notranslate"><span class="pre">setup</span></code> method takes one argument: a dictionary containing key-value pairs that assign a particular value to each input (exogenous uncertainty or policy lever) that is defined in the model scope. The keys must match exactly with the names of the parameters given in the scope.</p>
<p>If you have written your <code class="docutils literal notranslate"><span class="pre">setup</span></code> method to call the super-class <code class="docutils literal notranslate"><span class="pre">setup</span></code>, you will find that if you give keys as input that are not defined in the scope, you’ll get a KeyError.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">bad_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;name_not_in_scope&#39;</span><span class="p">:</span> <span class="s1">&#39;is_a_problem&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">fx</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">bad_params</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
    <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
[00:02.97] MainProcess/INFO: RoadTestFileModel SETUP...
[00:02.97] MainProcess/ERROR: KeyError(&#34;&#39;name_not_in_scope&#39; not found in scope parameters&#34;)
</pre></div></div>
</div>
<p>On the other hand, your custom model may or may not allow you to leave out some parameters. It is up to you to decide how to handle missing values, either by setting them at their default values or raising an error. In normal operation, parameters typically won’t be left out from the design of experiments, so it is not usually important to monitor this carefully.</p>
<p>In our example module’s <code class="docutils literal notranslate"><span class="pre">setup</span></code>, all of the uncertainty values must be given, because the template file would be unusable otherwise. But the policy levers can be omitted, and if so they are left at their default values in the original file. Note that the default values in that file are not strictly consistent with the default values in the scope file, and TMIP-EMAT does nothing on its own to address this discrepancy.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;expand_capacity&#39;</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
    <span class="s1">&#39;amortization_period&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
    <span class="s1">&#39;debt_type&#39;</span><span class="p">:</span> <span class="s2">&quot;Paygo&quot;</span><span class="p">,</span>
    <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.1234</span><span class="p">,</span>
    <span class="s1">&#39;beta&#39;</span><span class="p">:</span> <span class="mf">4.0</span><span class="p">,</span>
    <span class="s1">&#39;input_flow&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="s1">&#39;value_of_time&#39;</span><span class="p">:</span> <span class="mf">0.075</span><span class="p">,</span>
    <span class="s1">&#39;unit_cost_expansion&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="s1">&#39;interest_rate&#39;</span><span class="p">:</span> <span class="mf">0.035</span><span class="p">,</span>
    <span class="s1">&#39;yield_curve&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span>
<span class="p">}</span> <span class="c1"># interest_rate_lock is missing, that&#39;s ok</span>

<span class="n">fx</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
[00:02.97] MainProcess/INFO: RoadTestFileModel SETUP...
[00:02.98] MainProcess/INFO: RoadTestFileModel SETUP complete
</pre></div></div>
</div>
<p>After running <code class="docutils literal notranslate"><span class="pre">setup</span></code> successfully, we will have overwritten the “demo-inputs-l.yml” file with new values, and written a new “demo-inputs-x.yml” file into the model working directory with those values.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_dir</span><span class="p">(</span><span class="n">fx</span><span class="o">.</span><span class="n">local_directory</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
tmptek60l8k/
├── road-test-demo.db
├── road-test-files/
│   ├── demo-inputs-l.yml
│   ├── demo-inputs-x.yml
│   └── demo-inputs-x.yml.template
├── road-test-model-config.yml
└── road-test-scope.yml
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_file_contents</span><span class="p">(</span><span class="n">fx</span><span class="o">.</span><span class="n">local_directory</span><span class="p">,</span> <span class="s1">&#39;road-test-files&#39;</span><span class="p">,</span> <span class="s1">&#39;demo-inputs-l.yml&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
---
# This file defines lever values for the files-based
# Road Test example.  It is intentionally a complex way
# to implement this Python-based model, designed to
# demonstrate how to use a files-based model called
# from the command line.
expand_capacity: 75
amortization_period: 25
interest_rate_lock: False
debt_type: Paygo
lane_width: 10
mandatory_unused_lever: 42
...
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_file_contents</span><span class="p">(</span><span class="n">fx</span><span class="o">.</span><span class="n">local_directory</span><span class="p">,</span> <span class="s1">&#39;road-test-files&#39;</span><span class="p">,</span> <span class="s1">&#39;demo-inputs-x.yml&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
---
# This file defines uncertainty values for the files-based
# Road Test example.  It is intentionally a complex way
# to implement this Python-based model, designed to
# demonstrate how to use a files-based model called
# from the command line.
alpha: 0.1234
beta: 4.0
input_flow: 100
value_of_time: 0.075
labor_unit_cost_expansion: 60.0
materials_unit_cost_expansion: 40.0
interest_rate: 0.035
yield_curve: 0.01
...
</pre></div></div>
</div>
</div>
<div class="section" id="run">
<h3>run<a class="headerlink" href="#run" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">run</span></code> method is the place where the core model run takes place. Note that this method takes no arguments; all the input exogenous uncertainties and policy levers are delivered to the core model in the <code class="docutils literal notranslate"><span class="pre">setup</span></code> method, which will be executed prior to calling this method. This facilitates debugging, as the <code class="docutils literal notranslate"><span class="pre">setup</span></code> method can be used without the <code class="docutils literal notranslate"><span class="pre">run</span></code> method as we did above, allowing us to manually inspect the prepared files and ensure they are correct before actually running a
potentially expensive model.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fx</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
[00:03.00] MainProcess/INFO: RoadTestFileModel RUN ...
[00:05.99] MainProcess/INFO: RoadTestFileModel RUN complete
</pre></div></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">RoadTestFileModel</span></code> class includes a custom <code class="docutils literal notranslate"><span class="pre">last_run_logs</span></code> method, which displays both the “stdout” and “stderr” logs generated by the model executable during the most recent call to the <code class="docutils literal notranslate"><span class="pre">run</span></code> method. We can use this method for debugging purposes, to identify why the core model crashes (if it does crash). In this first test it did not crash, and the logs look good.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fx</span><span class="o">.</span><span class="n">last_run_logs</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
=== STDOUT ===
[2020-07-01 13:41:02,612] emat.RoadTest.INFO: running emat-road-test-demo
[2020-07-01 13:41:02,618] emat.RoadTest.INFO: emat-road-test-demo completed without errors

=== END OF LOG ===
</pre></div></div>
</div>
</div>
<div class="section" id="post-process">
<h3>post-process<a class="headerlink" href="#post-process" title="Permalink to this headline">¶</a></h3>
<p>There is an (optional) <code class="docutils literal notranslate"><span class="pre">post_process</span></code> step that is separate from the <code class="docutils literal notranslate"><span class="pre">run</span></code> step.</p>
<p>Post-processing differs from the main model run in two important ways:</p>
<ul class="simple">
<li>It can be run to efficiently generate a subset of performance measures.</li>
<li>It can be run based on archived model main-run core model results.</li>
</ul>
<p>Both features are designed to support workflows where new performance measures are added to the exploratory scope after the main model run(s) are completed. By allowing the <code class="docutils literal notranslate"><span class="pre">post_process</span></code> method to be run only for a subset of measures, we can avoid replicating possibly expensive post-processing steps when we have already completed them, or when they are not needed for a particular application.</p>
<p>For example, consider an exploratory modeling activity where the scope at the time of the initial model run experiments was focused on highway measures, and transit usage was not explored extensively, and no network assignment was done for transit trips when the experiments were initially run. By creating a post-process step to run the transit network assignment, we can apply that step to existing archived results, as well as have it run automatically for future model experients where transit
usage is under study, but continue to omit it for future model experients where we do not need it.</p>
<p>An optional <code class="docutils literal notranslate"><span class="pre">measure_names</span></code> argument allows the post-processor to identify which measures need additional computational effort to generate, and to skip excluded measures that are not currently of interest, or which have already been computed and do not need to be computed again.</p>
<p>The post processing is isolated from the main model run to allow it to be run later using archived model results. When executed directly after a core model run, it will operate on the results of the model stored in the local working directory. However, it can also be used with an optional <code class="docutils literal notranslate"><span class="pre">output_path</span></code> argument, which can be pointed at a model archive directory instead of the local working directory.</p>
<p>A consequence of this (and an intentional limitation) is that the <code class="docutils literal notranslate"><span class="pre">post_process</span></code> method should only use files from the set of files that are or will be archived from the core model run, and not attempt to use other non-persistent temporary or intermediate files that will not be archived.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fx</span><span class="o">.</span><span class="n">post_process</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
[00:06.00] MainProcess/INFO: RoadTestFileModel POST-PROCESS ...
[00:06.03] MainProcess/INFO: RoadTestFileModel POST-PROCESS complete
</pre></div></div>
</div>
<p>At this point, the model’s output performance measures should be available in one or more output files that can be read in the next step. For this example, the results are written to two separate files: ‘output_1.csv.gz’ and ‘output.yaml’.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_file_contents</span><span class="p">(</span><span class="n">fx</span><span class="o">.</span><span class="n">local_directory</span><span class="p">,</span> <span class="s1">&#39;road-test-files&#39;</span><span class="p">,</span> <span class="s2">&quot;Outputs&quot;</span><span class="p">,</span> <span class="s2">&quot;output.yaml&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
build_travel_time: 60.78943107038733
no_build_travel_time: 67.404
time_savings: 6.614568929612666

</pre></div></div>
</div>
<p>Note in this example, some of the values in the <code class="docutils literal notranslate"><span class="pre">output_1.csv.gz</span></code> file are intentionally manipulated in a contrived manner, so that there is some work for the post-processor to do.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_file_contents</span><span class="p">(</span><span class="n">fx</span><span class="o">.</span><span class="n">local_directory</span><span class="p">,</span> <span class="s1">&#39;road-test-files&#39;</span><span class="p">,</span> <span class="s2">&quot;Outputs&quot;</span><span class="p">,</span> <span class="s2">&quot;output_1.csv.gz&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
,value_of_time_savings,present_cost_expansion,cost_of_capacity_expansion,net_benefits
exp,1.0508604102769246,,1.3651577800056909,
plain,49.60926697209499,7500.0,311.2700117047018,-261.6607447326066

</pre></div></div>
</div>
</div>
<div class="section" id="load-measures">
<h3>load-measures<a class="headerlink" href="#load-measures" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">load_measures</span></code> method is the place to actually reach into files in the core model’s run results and extract performance measures, returning a dictionary of key-value pairs for the various performance measures. It takes an optional list giving a subset of performance measures to load, and like the <code class="docutils literal notranslate"><span class="pre">post_process</span></code> method also can be pointed at an archive location instead of loading measures from the local working directory (which is the default). The <code class="docutils literal notranslate"><span class="pre">load_measures</span></code> method should not do
any post-processing of results (i.e.&nbsp;it should read from but not write to the model outputs directory).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fx</span><span class="o">.</span><span class="n">load_measures</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;value_of_time_savings&#39;: 49.60926697209499,
 &#39;present_cost_expansion&#39;: 7500.0,
 &#39;cost_of_capacity_expansion&#39;: 311.2700117047018,
 &#39;net_benefits&#39;: -261.6607447326066,
 &#39;build_travel_time&#39;: 60.78943107038733,
 &#39;no_build_travel_time&#39;: 67.404,
 &#39;time_savings&#39;: 6.614568929612666}
</pre></div></div>
</div>
<p>You may note that the implementation of <code class="docutils literal notranslate"><span class="pre">RoadTestFileModel</span></code> in the <code class="docutils literal notranslate"><span class="pre">core_files_demo</span></code> module does not actually include a <code class="docutils literal notranslate"><span class="pre">load_measures</span></code> method itself, but instead inherits this method from the <code class="docutils literal notranslate"><span class="pre">FilesCoreModel</span></code> superclass. The instructions on how to actually find the relevant performance measures for this file are instead loaded into table parsers, which are defined in the <code class="docutils literal notranslate"><span class="pre">RoadTestFileModel.__init__</span></code> constructor. There are <a class="reference external" href="https://tmip-emat.github.io/source/emat.models/table_parse_example.html">details and illustrations of how to write and use parsers in
the file parsing examples page of the TMIP-EMAT documentation.</a></p>
</div>
<div class="section" id="archive">
<h3>archive<a class="headerlink" href="#archive" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">archive</span></code> method copies the relevant model output files to an archive location for longer term storage. The particular archive location is based on the experiment id for a particular experiment, and can be customized if desired by overloading the <code class="docutils literal notranslate"><span class="pre">get_experiment_archive_path</span></code> method. This customization is not done in this demo, so the default location is used.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fx</span><span class="o">.</span><span class="n">get_experiment_archive_path</span><span class="p">(</span><span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;/var/folders/js/bk_dt9015j79_f6bxnc44dsr0000gp/T/tmptek60l8k/./archive/scp_EMAT Road Test/exp_1&#39;
</pre></div></div>
</div>
<p>Actually running the <code class="docutils literal notranslate"><span class="pre">archive</span></code> method should copy any relevant output files from the <code class="docutils literal notranslate"><span class="pre">model_path</span></code> of the current active model into a subdirectory of <code class="docutils literal notranslate"><span class="pre">archive_path</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fx</span><span class="o">.</span><span class="n">archive</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
[00:06.08] MainProcess/INFO: RoadTestFileModel ARCHIVE
 from: /var/folders/js/bk_dt9015j79_f6bxnc44dsr0000gp/T/tmptek60l8k/road-test-files
   to: /var/folders/js/bk_dt9015j79_f6bxnc44dsr0000gp/T/tmptek60l8k/./archive/scp_EMAT Road Test/exp_1
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">show_dir</span><span class="p">(</span><span class="n">fx</span><span class="o">.</span><span class="n">local_directory</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
tmptek60l8k/
├── archive/
│   └── scp_EMAT Road Test/
│       └── exp_1/
│           ├── demo-inputs-l.yml
│           ├── demo-inputs-x.yml
│           ├── demo-inputs-x.yml.template
│           ├── emat-road-test.log
│           ├── output.csv.gz
│           ├── output.yaml
│           └── Outputs/
│               ├── output.yaml
│               └── output_1.csv.gz
├── road-test-demo.db
├── road-test-files/
│   ├── demo-inputs-l.yml
│   ├── demo-inputs-x.yml
│   ├── demo-inputs-x.yml.template
│   ├── emat-road-test.log
│   ├── output.csv.gz
│   ├── output.yaml
│   └── Outputs/
│       ├── output.yaml
│       └── output_1.csv.gz
├── road-test-model-config.yml
└── road-test-scope.yml
</pre></div></div>
</div>
<p>It is permissible, but not required, to simply copy the entire contents of the former to the latter, as is done in this example. However, if the current active model directory has a lot of boilerplate files that don’t change with the inputs, or if it becomes full of intermediate or temporary files that definitely will never be used to compute performance measures, it can be advisable to selectively copy only relevant files. In that case, those files and whatever related sub-directory tree
structure exists in the current active model should be replicated within the experiments archive directory.</p>
</div>
</div>
<div class="section" id="Normal-Operation-for-Running-Multiple-Experiments">
<h2>Normal Operation for Running Multiple Experiments<a class="headerlink" href="#Normal-Operation-for-Running-Multiple-Experiments" title="Permalink to this headline">¶</a></h2>
<p>For this demo, we’ll create a design of experiments with only 8 experiments. The <code class="docutils literal notranslate"><span class="pre">design_experiments</span></code> method of the <code class="docutils literal notranslate"><span class="pre">RoadTestFileModel</span></code> object is not defined in the custom <code class="docutils literal notranslate"><span class="pre">core_files_demo</span></code> written for this model, but rather is a generic function provide by the TMIP-EMAT main library. Real applications will typically use a larger number of experiments, but this small number is sufficient to demonstrate the operation of the tools.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">design1</span> <span class="o">=</span> <span class="n">fx</span><span class="o">.</span><span class="n">design_experiments</span><span class="p">(</span><span class="n">design_name</span><span class="o">=</span><span class="s1">&#39;lhs_1&#39;</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">design1</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>alpha</th>
      <th>amortization_period</th>
      <th>beta</th>
      <th>debt_type</th>
      <th>expand_capacity</th>
      <th>input_flow</th>
      <th>interest_rate</th>
      <th>interest_rate_lock</th>
      <th>unit_cost_expansion</th>
      <th>value_of_time</th>
      <th>yield_curve</th>
      <th>free_flow_time</th>
      <th>initial_capacity</th>
    </tr>
    <tr>
      <th>experiment</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>0.134750</td>
      <td>36</td>
      <td>4.642370</td>
      <td>Rev Bond</td>
      <td>24.901018</td>
      <td>85</td>
      <td>0.039219</td>
      <td>False</td>
      <td>143.519760</td>
      <td>0.017005</td>
      <td>0.003280</td>
      <td>60</td>
      <td>100</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.115907</td>
      <td>50</td>
      <td>5.242315</td>
      <td>Rev Bond</td>
      <td>11.985022</td>
      <td>114</td>
      <td>0.025997</td>
      <td>True</td>
      <td>107.836739</td>
      <td>0.145378</td>
      <td>0.009659</td>
      <td>60</td>
      <td>100</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.178456</td>
      <td>30</td>
      <td>3.510139</td>
      <td>Paygo</td>
      <td>72.399552</td>
      <td>121</td>
      <td>0.029066</td>
      <td>True</td>
      <td>127.838010</td>
      <td>0.067821</td>
      <td>-0.000839</td>
      <td>60</td>
      <td>100</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.110023</td>
      <td>44</td>
      <td>4.887030</td>
      <td>Paygo</td>
      <td>28.565637</td>
      <td>127</td>
      <td>0.034673</td>
      <td>True</td>
      <td>125.799829</td>
      <td>0.083593</td>
      <td>0.002714</td>
      <td>60</td>
      <td>100</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.161977</td>
      <td>24</td>
      <td>3.865644</td>
      <td>GO Bond</td>
      <td>82.811459</td>
      <td>135</td>
      <td>0.028634</td>
      <td>True</td>
      <td>118.989447</td>
      <td>0.054968</td>
      <td>0.006745</td>
      <td>60</td>
      <td>100</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.173449</td>
      <td>21</td>
      <td>4.094118</td>
      <td>Paygo</td>
      <td>43.476172</td>
      <td>142</td>
      <td>0.033847</td>
      <td>False</td>
      <td>133.480778</td>
      <td>0.184904</td>
      <td>0.017674</td>
      <td>60</td>
      <td>100</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.141973</td>
      <td>19</td>
      <td>5.331978</td>
      <td>GO Bond</td>
      <td>52.445940</td>
      <td>98</td>
      <td>0.031519</td>
      <td>False</td>
      <td>99.317350</td>
      <td>0.115228</td>
      <td>0.014752</td>
      <td>60</td>
      <td>100</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.193762</td>
      <td>40</td>
      <td>4.453382</td>
      <td>Rev Bond</td>
      <td>92.278968</td>
      <td>95</td>
      <td>0.037907</td>
      <td>False</td>
      <td>103.543415</td>
      <td>0.092517</td>
      <td>0.014360</td>
      <td>60</td>
      <td>100</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">run_experiments</span></code> command will automatically run the model once for each experiment in the named design. The demo command line version of the road test model is (intentionally) a little bit slow, so will take a few seconds to conduct these eight model experiment runs.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fx</span><span class="o">.</span><span class="n">run_experiments</span><span class="p">(</span><span class="n">design_name</span><span class="o">=</span><span class="s1">&#39;lhs_1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
[00:06.15] MainProcess/INFO: performing 8 scenarios/policies * 1 model(s) = 8 experiments
[00:06.16] MainProcess/INFO: performing experiments sequentially
[00:06.16] MainProcess/INFO: RoadTestFileModel SETUP...
[00:06.17] MainProcess/INFO: RoadTestFileModel SETUP complete
[00:06.17] MainProcess/INFO: RoadTestFileModel RUN ...
[00:09.27] MainProcess/INFO: RoadTestFileModel RUN complete
[00:09.27] MainProcess/INFO: RoadTestFileModel POST-PROCESS ...
[00:09.29] MainProcess/INFO: RoadTestFileModel POST-PROCESS complete
[00:09.29] MainProcess/INFO: RoadTestFileModel ARCHIVE
 from: /var/folders/js/bk_dt9015j79_f6bxnc44dsr0000gp/T/tmptek60l8k/road-test-files
   to: /var/folders/js/bk_dt9015j79_f6bxnc44dsr0000gp/T/tmptek60l8k/./archive/scp_EMAT Road Test/exp_2
[00:09.30] MainProcess/INFO: 1 cases completed
[00:09.31] MainProcess/INFO: RoadTestFileModel SETUP...
[00:09.32] MainProcess/INFO: RoadTestFileModel SETUP complete
[00:09.32] MainProcess/INFO: RoadTestFileModel RUN ...
[00:12.44] MainProcess/INFO: RoadTestFileModel RUN complete
[00:12.44] MainProcess/INFO: RoadTestFileModel POST-PROCESS ...
[00:12.45] MainProcess/INFO: RoadTestFileModel POST-PROCESS complete
[00:12.46] MainProcess/INFO: RoadTestFileModel ARCHIVE
 from: /var/folders/js/bk_dt9015j79_f6bxnc44dsr0000gp/T/tmptek60l8k/road-test-files
   to: /var/folders/js/bk_dt9015j79_f6bxnc44dsr0000gp/T/tmptek60l8k/./archive/scp_EMAT Road Test/exp_3
[00:12.46] MainProcess/INFO: 2 cases completed
[00:12.47] MainProcess/INFO: RoadTestFileModel SETUP...
[00:12.47] MainProcess/INFO: RoadTestFileModel SETUP complete
[00:12.47] MainProcess/INFO: RoadTestFileModel RUN ...
[00:15.34] MainProcess/INFO: RoadTestFileModel RUN complete
[00:15.34] MainProcess/INFO: RoadTestFileModel POST-PROCESS ...
[00:15.35] MainProcess/INFO: RoadTestFileModel POST-PROCESS complete
[00:15.36] MainProcess/INFO: RoadTestFileModel ARCHIVE
 from: /var/folders/js/bk_dt9015j79_f6bxnc44dsr0000gp/T/tmptek60l8k/road-test-files
   to: /var/folders/js/bk_dt9015j79_f6bxnc44dsr0000gp/T/tmptek60l8k/./archive/scp_EMAT Road Test/exp_4
[00:15.37] MainProcess/INFO: 3 cases completed
[00:15.37] MainProcess/INFO: RoadTestFileModel SETUP...
[00:15.38] MainProcess/INFO: RoadTestFileModel SETUP complete
[00:15.38] MainProcess/INFO: RoadTestFileModel RUN ...
[00:17.90] MainProcess/INFO: RoadTestFileModel RUN complete
[00:17.90] MainProcess/INFO: RoadTestFileModel POST-PROCESS ...
[00:17.91] MainProcess/INFO: RoadTestFileModel POST-PROCESS complete
[00:17.92] MainProcess/INFO: RoadTestFileModel ARCHIVE
 from: /var/folders/js/bk_dt9015j79_f6bxnc44dsr0000gp/T/tmptek60l8k/road-test-files
   to: /var/folders/js/bk_dt9015j79_f6bxnc44dsr0000gp/T/tmptek60l8k/./archive/scp_EMAT Road Test/exp_5
[00:17.93] MainProcess/INFO: 4 cases completed
[00:17.93] MainProcess/INFO: RoadTestFileModel SETUP...
[00:17.93] MainProcess/INFO: RoadTestFileModel SETUP complete
[00:17.93] MainProcess/INFO: RoadTestFileModel RUN ...
[00:20.69] MainProcess/INFO: RoadTestFileModel RUN complete
[00:20.69] MainProcess/INFO: RoadTestFileModel POST-PROCESS ...
[00:20.71] MainProcess/INFO: RoadTestFileModel POST-PROCESS complete
[00:20.71] MainProcess/INFO: RoadTestFileModel ARCHIVE
 from: /var/folders/js/bk_dt9015j79_f6bxnc44dsr0000gp/T/tmptek60l8k/road-test-files
   to: /var/folders/js/bk_dt9015j79_f6bxnc44dsr0000gp/T/tmptek60l8k/./archive/scp_EMAT Road Test/exp_6
[00:20.72] MainProcess/INFO: 5 cases completed
[00:20.73] MainProcess/INFO: RoadTestFileModel SETUP...
[00:20.73] MainProcess/INFO: RoadTestFileModel SETUP complete
[00:20.73] MainProcess/INFO: RoadTestFileModel RUN ...
[00:23.32] MainProcess/INFO: RoadTestFileModel RUN complete
[00:23.32] MainProcess/INFO: RoadTestFileModel POST-PROCESS ...
[00:23.33] MainProcess/INFO: RoadTestFileModel POST-PROCESS complete
[00:23.34] MainProcess/INFO: RoadTestFileModel ARCHIVE
 from: /var/folders/js/bk_dt9015j79_f6bxnc44dsr0000gp/T/tmptek60l8k/road-test-files
   to: /var/folders/js/bk_dt9015j79_f6bxnc44dsr0000gp/T/tmptek60l8k/./archive/scp_EMAT Road Test/exp_7
[00:23.34] MainProcess/INFO: 6 cases completed
[00:23.35] MainProcess/INFO: RoadTestFileModel SETUP...
[00:23.35] MainProcess/INFO: RoadTestFileModel SETUP complete
[00:23.35] MainProcess/INFO: RoadTestFileModel RUN ...
[00:26.08] MainProcess/INFO: RoadTestFileModel RUN complete
[00:26.08] MainProcess/INFO: RoadTestFileModel POST-PROCESS ...
[00:26.09] MainProcess/INFO: RoadTestFileModel POST-PROCESS complete
[00:26.10] MainProcess/INFO: RoadTestFileModel ARCHIVE
 from: /var/folders/js/bk_dt9015j79_f6bxnc44dsr0000gp/T/tmptek60l8k/road-test-files
   to: /var/folders/js/bk_dt9015j79_f6bxnc44dsr0000gp/T/tmptek60l8k/./archive/scp_EMAT Road Test/exp_8
[00:26.11] MainProcess/INFO: 7 cases completed
[00:26.11] MainProcess/INFO: RoadTestFileModel SETUP...
[00:26.11] MainProcess/INFO: RoadTestFileModel SETUP complete
[00:26.11] MainProcess/INFO: RoadTestFileModel RUN ...
[00:29.04] MainProcess/ERROR: ERROR in run_core_model run 9: Command &#39;[&#39;emat-road-test-demo&#39;, &#39;--uncs&#39;, &#39;demo-inputs-x.yml&#39;, &#39;--levers&#39;, &#39;demo-inputs-l.yml&#39;]&#39; returned non-zero exit status 247.
[00:29.04] MainProcess/ERROR: run_core_model ABORT 9
[00:29.04] MainProcess/INFO: 8 cases completed
[00:29.04] MainProcess/INFO: experiments finished
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>alpha</th>
      <th>beta</th>
      <th>input_flow</th>
      <th>value_of_time</th>
      <th>unit_cost_expansion</th>
      <th>interest_rate</th>
      <th>yield_curve</th>
      <th>expand_capacity</th>
      <th>amortization_period</th>
      <th>debt_type</th>
      <th>interest_rate_lock</th>
      <th>free_flow_time</th>
      <th>initial_capacity</th>
      <th>no_build_travel_time</th>
      <th>build_travel_time</th>
      <th>time_savings</th>
      <th>value_of_time_savings</th>
      <th>net_benefits</th>
      <th>cost_of_capacity_expansion</th>
      <th>present_cost_expansion</th>
    </tr>
    <tr>
      <th>experiment</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>0.134750</td>
      <td>4.642370</td>
      <td>85</td>
      <td>0.017005</td>
      <td>143.519760</td>
      <td>0.039219</td>
      <td>0.003280</td>
      <td>24.901018</td>
      <td>36</td>
      <td>Rev Bond</td>
      <td>False</td>
      <td>60</td>
      <td>100</td>
      <td>63.802031</td>
      <td>61.354318</td>
      <td>2.447713</td>
      <td>3.537924</td>
      <td>-175.134011</td>
      <td>178.671935</td>
      <td>3573.788162</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.115907</td>
      <td>5.242315</td>
      <td>114</td>
      <td>0.145378</td>
      <td>107.836739</td>
      <td>0.025997</td>
      <td>0.009659</td>
      <td>11.985022</td>
      <td>50</td>
      <td>Rev Bond</td>
      <td>True</td>
      <td>60</td>
      <td>100</td>
      <td>73.822149</td>
      <td>67.635961</td>
      <td>6.186188</td>
      <td>102.524606</td>
      <td>42.361931</td>
      <td>60.162675</td>
      <td>1292.425695</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.178456</td>
      <td>3.510139</td>
      <td>121</td>
      <td>0.067821</td>
      <td>127.838010</td>
      <td>0.029066</td>
      <td>-0.000839</td>
      <td>72.399552</td>
      <td>30</td>
      <td>Paygo</td>
      <td>True</td>
      <td>60</td>
      <td>100</td>
      <td>80.905959</td>
      <td>63.090263</td>
      <td>17.815696</td>
      <td>146.201784</td>
      <td>-183.229667</td>
      <td>329.431451</td>
      <td>9255.414627</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.110023</td>
      <td>4.887030</td>
      <td>127</td>
      <td>0.083593</td>
      <td>125.799829</td>
      <td>0.034673</td>
      <td>0.002714</td>
      <td>28.565637</td>
      <td>44</td>
      <td>Paygo</td>
      <td>True</td>
      <td>60</td>
      <td>100</td>
      <td>81.228935</td>
      <td>66.217725</td>
      <td>15.011210</td>
      <td>159.363387</td>
      <td>61.567385</td>
      <td>97.796001</td>
      <td>3593.552248</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.161977</td>
      <td>3.865644</td>
      <td>135</td>
      <td>0.054968</td>
      <td>118.989447</td>
      <td>0.028634</td>
      <td>0.006745</td>
      <td>82.811459</td>
      <td>24</td>
      <td>GO Bond</td>
      <td>True</td>
      <td>60</td>
      <td>100</td>
      <td>91.004725</td>
      <td>63.010343</td>
      <td>27.994382</td>
      <td>207.737074</td>
      <td>-374.545620</td>
      <td>582.282695</td>
      <td>9853.689681</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.173449</td>
      <td>4.094118</td>
      <td>142</td>
      <td>0.184904</td>
      <td>133.480778</td>
      <td>0.033847</td>
      <td>0.017674</td>
      <td>43.476172</td>
      <td>21</td>
      <td>Paygo</td>
      <td>False</td>
      <td>60</td>
      <td>100</td>
      <td>103.733064</td>
      <td>69.975507</td>
      <td>33.757557</td>
      <td>886.351136</td>
      <td>604.765873</td>
      <td>281.585263</td>
      <td>5803.233337</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.141973</td>
      <td>5.331978</td>
      <td>98</td>
      <td>0.115228</td>
      <td>99.317350</td>
      <td>0.031519</td>
      <td>0.014752</td>
      <td>52.445940</td>
      <td>19</td>
      <td>GO Bond</td>
      <td>False</td>
      <td>60</td>
      <td>100</td>
      <td>67.648456</td>
      <td>60.807614</td>
      <td>6.840842</td>
      <td>77.249238</td>
      <td>-282.042005</td>
      <td>359.291243</td>
      <td>5208.791736</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.193762</td>
      <td>4.453382</td>
      <td>95</td>
      <td>0.092517</td>
      <td>103.543415</td>
      <td>0.037907</td>
      <td>0.014360</td>
      <td>92.278968</td>
      <td>40</td>
      <td>Rev Bond</td>
      <td>False</td>
      <td>60</td>
      <td>100</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="section" id="Re-running-Failed-Experiments">
<h3>Re-running Failed Experiments<a class="headerlink" href="#Re-running-Failed-Experiments" title="Permalink to this headline">¶</a></h3>
<p>If you pay attention to the logged output, you might notice that one of the experiments (the last one) failed. We can see <code class="docutils literal notranslate"><span class="pre">NaN</span></code> values in the outputs.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">results</span> <span class="o">=</span> <span class="n">fx</span><span class="o">.</span><span class="n">read_experiment_measures</span><span class="p">(</span><span class="s1">&#39;lhs_1&#39;</span><span class="p">)</span>
<span class="n">results</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>no_build_travel_time</th>
      <th>build_travel_time</th>
      <th>time_savings</th>
      <th>value_of_time_savings</th>
      <th>net_benefits</th>
      <th>cost_of_capacity_expansion</th>
      <th>present_cost_expansion</th>
    </tr>
    <tr>
      <th>experiment</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>63.802031</td>
      <td>61.354318</td>
      <td>2.447713</td>
      <td>3.537924</td>
      <td>-175.134011</td>
      <td>178.671935</td>
      <td>3573.788162</td>
    </tr>
    <tr>
      <th>3</th>
      <td>73.822149</td>
      <td>67.635961</td>
      <td>6.186188</td>
      <td>102.524606</td>
      <td>42.361931</td>
      <td>60.162675</td>
      <td>1292.425695</td>
    </tr>
    <tr>
      <th>4</th>
      <td>80.905959</td>
      <td>63.090263</td>
      <td>17.815696</td>
      <td>146.201784</td>
      <td>-183.229667</td>
      <td>329.431451</td>
      <td>9255.414627</td>
    </tr>
    <tr>
      <th>5</th>
      <td>81.228935</td>
      <td>66.217725</td>
      <td>15.011210</td>
      <td>159.363387</td>
      <td>61.567385</td>
      <td>97.796001</td>
      <td>3593.552248</td>
    </tr>
    <tr>
      <th>6</th>
      <td>91.004725</td>
      <td>63.010343</td>
      <td>27.994382</td>
      <td>207.737074</td>
      <td>-374.545620</td>
      <td>582.282695</td>
      <td>9853.689681</td>
    </tr>
    <tr>
      <th>7</th>
      <td>103.733064</td>
      <td>69.975507</td>
      <td>33.757557</td>
      <td>886.351136</td>
      <td>604.765873</td>
      <td>281.585263</td>
      <td>5803.233337</td>
    </tr>
    <tr>
      <th>8</th>
      <td>67.648456</td>
      <td>60.807614</td>
      <td>6.840842</td>
      <td>77.249238</td>
      <td>-282.042005</td>
      <td>359.291243</td>
      <td>5208.791736</td>
    </tr>
    <tr>
      <th>9</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>We can collect the id’s of the failed experiments programmatically. To collect all the experiments that are missing any performance measure output, we can do this:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fails</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">failed_experiment_ids</span> <span class="o">=</span> <span class="n">fails</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">fails</span><span class="p">]</span>
<span class="n">failed_experiment_ids</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Int64Index([9], dtype=&#39;int64&#39;, name=&#39;experiment&#39;)
</pre></div></div>
</div>
<p>When there is an error (thrown as a <code class="docutils literal notranslate"><span class="pre">subprocess.CalledProcessError</span></code>) during the execution of a <code class="docutils literal notranslate"><span class="pre">FilesCoreModel</span></code>, the output from stdout and stderr are written to log files in the archive location, instead of having the legit model outputs written there.</p>
<p>We can see the log output by reading in the log file, like this:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">error_log</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">fx</span><span class="o">.</span><span class="n">get_experiment_archive_path</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span>
    <span class="s1">&#39;error.stdout.log&#39;</span>
<span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">error_log</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stdout</span><span class="p">:</span>
    <span class="n">error_log_content</span> <span class="o">=</span> <span class="n">stdout</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">error_log_content</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[2020-07-01 13:41:25,675] emat.RoadTest.INFO: running emat-road-test-demo
[2020-07-01 13:41:25,678] emat.RoadTest.ERROR: Random crash, ha ha!

</pre></div></div>
</div>
<p>Here we see the log file is explicitly taunting us about randomly crashing the model run. That’s fine – we wanted to crash the execution randomly to show what to do in this event, cause it happens sometimes. Maybe a disk filled up, or there is an intermittent license problem that causes a failure one in a while. If that’s the case and we can fix it just by re-running, awesome!</p>
<p>We can load just the failed experiments to try them again.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">failed_experiments</span> <span class="o">=</span> <span class="n">fx</span><span class="o">.</span><span class="n">read_experiment_parameters</span><span class="p">(</span><span class="n">experiment_ids</span><span class="o">=</span><span class="n">failed_experiment_ids</span><span class="p">)</span>
<span class="n">failed_experiments</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>free_flow_time</th>
      <th>initial_capacity</th>
      <th>alpha</th>
      <th>beta</th>
      <th>input_flow</th>
      <th>value_of_time</th>
      <th>unit_cost_expansion</th>
      <th>interest_rate</th>
      <th>yield_curve</th>
      <th>expand_capacity</th>
      <th>amortization_period</th>
      <th>debt_type</th>
      <th>interest_rate_lock</th>
    </tr>
    <tr>
      <th>experiment</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>9</th>
      <td>60</td>
      <td>100</td>
      <td>0.193762</td>
      <td>4.453382</td>
      <td>95</td>
      <td>0.092517</td>
      <td>103.543415</td>
      <td>0.037907</td>
      <td>0.01436</td>
      <td>92.278968</td>
      <td>40</td>
      <td>Rev Bond</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Normally, there is a “short circuit” process that will prevent re-running a core model experiment, instead the performance measure results will simply be loaded from the database, which is typically much faster than actually running the core model. But, if the performance measures stored in the database are junk, we will not want to trigger the short circuit system, and actually run the full core model again. To do so, we can disable the short circuit like this:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fx</span><span class="o">.</span><span class="n">allow_short_circuit</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
<p>Now we can re-run the failed experiment. If it failed because of a transient error, e.g.&nbsp;a disk space problem that’s been fixed, then perhaps we can simply re-run the model and it will work.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fx</span><span class="o">.</span><span class="n">run_experiments</span><span class="p">(</span><span class="n">failed_experiments</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
[00:29.13] MainProcess/INFO: performing 1 scenarios/policies * 1 model(s) = 1 experiments
[00:29.15] MainProcess/INFO: performing experiments sequentially
[00:29.15] MainProcess/INFO: RoadTestFileModel SETUP...
[00:29.15] MainProcess/INFO: RoadTestFileModel SETUP complete
[00:29.15] MainProcess/INFO: RoadTestFileModel RUN ...
[00:31.72] MainProcess/INFO: RoadTestFileModel RUN complete
[00:31.72] MainProcess/INFO: RoadTestFileModel POST-PROCESS ...
[00:31.73] MainProcess/INFO: RoadTestFileModel POST-PROCESS complete
[00:31.74] MainProcess/INFO: RoadTestFileModel ARCHIVE
 from: /var/folders/js/bk_dt9015j79_f6bxnc44dsr0000gp/T/tmptek60l8k/road-test-files
   to: /var/folders/js/bk_dt9015j79_f6bxnc44dsr0000gp/T/tmptek60l8k/./archive/scp_EMAT Road Test/exp_9
[00:31.75] MainProcess/INFO: 1 cases completed
[00:31.75] MainProcess/INFO: experiments finished
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>alpha</th>
      <th>beta</th>
      <th>input_flow</th>
      <th>value_of_time</th>
      <th>unit_cost_expansion</th>
      <th>interest_rate</th>
      <th>yield_curve</th>
      <th>expand_capacity</th>
      <th>amortization_period</th>
      <th>debt_type</th>
      <th>interest_rate_lock</th>
      <th>free_flow_time</th>
      <th>initial_capacity</th>
      <th>no_build_travel_time</th>
      <th>build_travel_time</th>
      <th>time_savings</th>
      <th>value_of_time_savings</th>
      <th>net_benefits</th>
      <th>cost_of_capacity_expansion</th>
      <th>present_cost_expansion</th>
    </tr>
    <tr>
      <th>experiment</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>9</th>
      <td>0.193762</td>
      <td>4.453382</td>
      <td>95</td>
      <td>0.092517</td>
      <td>103.543415</td>
      <td>0.037907</td>
      <td>0.01436</td>
      <td>92.278968</td>
      <td>40</td>
      <td>Rev Bond</td>
      <td>False</td>
      <td>60</td>
      <td>100</td>
      <td>69.251572</td>
      <td>60.503221</td>
      <td>8.748351</td>
      <td>76.890662</td>
      <td>-385.524839</td>
      <td>462.4155</td>
      <td>9554.87952</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Much better! Now we can see we have a more complete set of outputs, without the NaN’s. Hooray!</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">results</span> <span class="o">=</span> <span class="n">fx</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">read_experiment_all</span><span class="p">(</span><span class="n">scope_name</span><span class="o">=</span><span class="n">fx</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">design_name</span><span class="o">=</span><span class="s1">&#39;lhs_1&#39;</span><span class="p">)</span>
<span class="n">results</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>free_flow_time</th>
      <th>initial_capacity</th>
      <th>alpha</th>
      <th>beta</th>
      <th>input_flow</th>
      <th>value_of_time</th>
      <th>unit_cost_expansion</th>
      <th>interest_rate</th>
      <th>yield_curve</th>
      <th>expand_capacity</th>
      <th>amortization_period</th>
      <th>debt_type</th>
      <th>interest_rate_lock</th>
      <th>no_build_travel_time</th>
      <th>build_travel_time</th>
      <th>time_savings</th>
      <th>value_of_time_savings</th>
      <th>net_benefits</th>
      <th>cost_of_capacity_expansion</th>
      <th>present_cost_expansion</th>
    </tr>
    <tr>
      <th>experiment</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>60</td>
      <td>100</td>
      <td>0.13475</td>
      <td>4.64237</td>
      <td>85</td>
      <td>0.0170047</td>
      <td>143.52</td>
      <td>0.0392193</td>
      <td>0.00327971</td>
      <td>24.901</td>
      <td>36</td>
      <td>Rev Bond</td>
      <td>0</td>
      <td>63.802</td>
      <td>61.3543</td>
      <td>2.44771</td>
      <td>3.53792</td>
      <td>-175.134</td>
      <td>178.672</td>
      <td>3573.79</td>
    </tr>
    <tr>
      <th>3</th>
      <td>60</td>
      <td>100</td>
      <td>0.115907</td>
      <td>5.24231</td>
      <td>114</td>
      <td>0.145378</td>
      <td>107.837</td>
      <td>0.0259967</td>
      <td>0.00965899</td>
      <td>11.985</td>
      <td>50</td>
      <td>Rev Bond</td>
      <td>1</td>
      <td>73.8221</td>
      <td>67.636</td>
      <td>6.18619</td>
      <td>102.525</td>
      <td>42.3619</td>
      <td>60.1627</td>
      <td>1292.43</td>
    </tr>
    <tr>
      <th>4</th>
      <td>60</td>
      <td>100</td>
      <td>0.178456</td>
      <td>3.51014</td>
      <td>121</td>
      <td>0.067821</td>
      <td>127.838</td>
      <td>0.0290662</td>
      <td>-0.00083927</td>
      <td>72.3996</td>
      <td>30</td>
      <td>Paygo</td>
      <td>1</td>
      <td>80.906</td>
      <td>63.0903</td>
      <td>17.8157</td>
      <td>146.202</td>
      <td>-183.23</td>
      <td>329.431</td>
      <td>9255.41</td>
    </tr>
    <tr>
      <th>5</th>
      <td>60</td>
      <td>100</td>
      <td>0.110023</td>
      <td>4.88703</td>
      <td>127</td>
      <td>0.0835929</td>
      <td>125.8</td>
      <td>0.0346728</td>
      <td>0.00271409</td>
      <td>28.5656</td>
      <td>44</td>
      <td>Paygo</td>
      <td>1</td>
      <td>81.2289</td>
      <td>66.2177</td>
      <td>15.0112</td>
      <td>159.363</td>
      <td>61.5674</td>
      <td>97.796</td>
      <td>3593.55</td>
    </tr>
    <tr>
      <th>6</th>
      <td>60</td>
      <td>100</td>
      <td>0.161977</td>
      <td>3.86564</td>
      <td>135</td>
      <td>0.0549679</td>
      <td>118.989</td>
      <td>0.0286337</td>
      <td>0.00674486</td>
      <td>82.8115</td>
      <td>24</td>
      <td>GO Bond</td>
      <td>1</td>
      <td>91.0047</td>
      <td>63.0103</td>
      <td>27.9944</td>
      <td>207.737</td>
      <td>-374.546</td>
      <td>582.283</td>
      <td>9853.69</td>
    </tr>
    <tr>
      <th>7</th>
      <td>60</td>
      <td>100</td>
      <td>0.173449</td>
      <td>4.09412</td>
      <td>142</td>
      <td>0.184904</td>
      <td>133.481</td>
      <td>0.0338467</td>
      <td>0.0176743</td>
      <td>43.4762</td>
      <td>21</td>
      <td>Paygo</td>
      <td>0</td>
      <td>103.733</td>
      <td>69.9755</td>
      <td>33.7576</td>
      <td>886.351</td>
      <td>604.766</td>
      <td>281.585</td>
      <td>5803.23</td>
    </tr>
    <tr>
      <th>8</th>
      <td>60</td>
      <td>100</td>
      <td>0.141973</td>
      <td>5.33198</td>
      <td>98</td>
      <td>0.115228</td>
      <td>99.3173</td>
      <td>0.0315185</td>
      <td>0.0147519</td>
      <td>52.4459</td>
      <td>19</td>
      <td>GO Bond</td>
      <td>0</td>
      <td>67.6485</td>
      <td>60.8076</td>
      <td>6.84084</td>
      <td>77.2492</td>
      <td>-282.042</td>
      <td>359.291</td>
      <td>5208.79</td>
    </tr>
    <tr>
      <th>9</th>
      <td>60</td>
      <td>100</td>
      <td>0.193762</td>
      <td>4.45338</td>
      <td>95</td>
      <td>0.0925175</td>
      <td>103.543</td>
      <td>0.0379069</td>
      <td>0.01436</td>
      <td>92.279</td>
      <td>40</td>
      <td>Rev Bond</td>
      <td>0</td>
      <td>69.2516</td>
      <td>60.5032</td>
      <td>8.74835</td>
      <td>76.8907</td>
      <td>-385.525</td>
      <td>462.416</td>
      <td>9554.88</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
</div>
<div class="section" id="Multiprocessing-for-Running-Multiple-Experiments">
<h2>Multiprocessing for Running Multiple Experiments<a class="headerlink" href="#Multiprocessing-for-Running-Multiple-Experiments" title="Permalink to this headline">¶</a></h2>
<p>The examples above are all single-process demonstrations of using TMIP-EMAT to run core model experiments. If your core model itself is multi-threaded or otherwise is designed to make full use of your multi-core CPU, or if a single core model run will otherwise max out some computational resource (e.g.&nbsp;RAM, disk space) then single process operation should be sufficient.</p>
<p>If, on the other hand, your core model is such that you can run multiple independent instances of the model side-by-side on the same machine, then you could benefit from a multiprocessing approach. This can be accomplished by splitting a design of experiments over several processes that you start manually, or by using an automatic multiprocessing library such as <code class="docutils literal notranslate"><span class="pre">dask.distributed</span></code>.</p>
<div class="section" id="Running-a-Subset-of-Experiments-Manually">
<h3>Running a Subset of Experiments Manually<a class="headerlink" href="#Running-a-Subset-of-Experiments-Manually" title="Permalink to this headline">¶</a></h3>
<p>Suppose, for example, you wanted to distribute the workload of running experiments over several processes, or even over several computers. If each process has file system access to the same TMIP-EMAT database of experiments, we can orchestrate these experiments in parallel by manually splitting up the processes.</p>
<p>To begin with, we’ll have one process create a complete design of experiments, and save it to the database (which happens automatically here).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">design2</span> <span class="o">=</span> <span class="n">fx</span><span class="o">.</span><span class="n">design_experiments</span><span class="p">(</span><span class="n">design_name</span><span class="o">=</span><span class="s1">&#39;lhs_2&#39;</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Then, we can create set up a copy of the same model in a different process, even on a different machine, as long as we point back to the same original database file. This implies the different process has access to the file system where the original file is stored. It is valuable to read and write to the same database file, not just a copy of the file, as this will obviate the need to sync the experimental data manually afterwards. In this demo, we’ll just create a new directory to work in, but
we’ll point to the database in the original directory. Instead of allowing our model to implicitly create a new database file in the new directory, we’ll instantiate a SQLiteDB object pointing to the original database.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">database_filename</span> <span class="o">=</span> <span class="n">fx</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">database_path</span>
<span class="n">db2</span> <span class="o">=</span> <span class="n">emat</span><span class="o">.</span><span class="n">SQLiteDB</span><span class="p">(</span><span class="n">database_filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now, <code class="docutils literal notranslate"><span class="pre">db2</span></code> is a <code class="docutils literal notranslate"><span class="pre">emat.SQLiteDB</span></code> object, which wraps a <em>new</em> connection to the <em>original</em> database. Then, we’ll pass that <code class="docutils literal notranslate"><span class="pre">db2</span></code> explicitly to the new <code class="docutils literal notranslate"><span class="pre">RoadTestFileModel</span></code> constructor, which will create a complete copy of our model (other than the database) in a new directory.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fx2</span> <span class="o">=</span> <span class="n">core_files_demo</span><span class="o">.</span><span class="n">RoadTestFileModel</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="n">db2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
[00:31.83] MainProcess/WARNING: changing cwd to /var/folders/js/bk_dt9015j79_f6bxnc44dsr0000gp/T/tmpm4ri_fl2
</pre></div></div>
</div>
<p>To run a particular slice of a design of experiments, we need to load the experimental design first, and then pass that slice to the <code class="docutils literal notranslate"><span class="pre">run_experiments</span></code> function, instead of just giving the <code class="docutils literal notranslate"><span class="pre">design_name</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">design2</span> <span class="o">=</span> <span class="n">fx</span><span class="o">.</span><span class="n">read_experiment_parameters</span><span class="p">(</span><span class="s1">&#39;lhs_2&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>For splitting the work across a number of similarly capable processes or machines, the double-colon slice is convenient. If, for example, you are splitting the work over 4 computers, you can run each with slices <code class="docutils literal notranslate"><span class="pre">0::4</span></code>, <code class="docutils literal notranslate"><span class="pre">1::4</span></code>, <code class="docutils literal notranslate"><span class="pre">2::4</span></code>, and <code class="docutils literal notranslate"><span class="pre">3::4</span></code>. This slices in skip-step manner, so slice below will run every 4th experiment from the design, starting with experiment index 0 (i.e.&nbsp;the first one).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fx2</span><span class="o">.</span><span class="n">run_experiments</span><span class="p">(</span><span class="n">design2</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">4</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
[00:31.89] MainProcess/INFO: performing 2 scenarios/policies * 1 model(s) = 2 experiments
[00:31.91] MainProcess/INFO: performing experiments sequentially
[00:31.91] MainProcess/INFO: RoadTestFileModel SETUP...
[00:31.91] MainProcess/INFO: RoadTestFileModel SETUP complete
[00:31.91] MainProcess/INFO: RoadTestFileModel RUN ...
[00:34.50] MainProcess/INFO: RoadTestFileModel RUN complete
[00:34.50] MainProcess/INFO: RoadTestFileModel POST-PROCESS ...
[00:34.51] MainProcess/INFO: RoadTestFileModel POST-PROCESS complete
[00:34.52] MainProcess/INFO: RoadTestFileModel ARCHIVE
 from: /var/folders/js/bk_dt9015j79_f6bxnc44dsr0000gp/T/tmpm4ri_fl2/road-test-files
   to: /var/folders/js/bk_dt9015j79_f6bxnc44dsr0000gp/T/tmpm4ri_fl2/./archive/scp_EMAT Road Test/exp_10
[00:34.52] MainProcess/INFO: 1 cases completed
[00:34.53] MainProcess/INFO: RoadTestFileModel SETUP...
[00:34.54] MainProcess/INFO: RoadTestFileModel SETUP complete
[00:34.54] MainProcess/INFO: RoadTestFileModel RUN ...
[00:37.17] MainProcess/INFO: RoadTestFileModel RUN complete
[00:37.18] MainProcess/INFO: RoadTestFileModel POST-PROCESS ...
[00:37.19] MainProcess/INFO: RoadTestFileModel POST-PROCESS complete
[00:37.20] MainProcess/INFO: RoadTestFileModel ARCHIVE
 from: /var/folders/js/bk_dt9015j79_f6bxnc44dsr0000gp/T/tmpm4ri_fl2/road-test-files
   to: /var/folders/js/bk_dt9015j79_f6bxnc44dsr0000gp/T/tmpm4ri_fl2/./archive/scp_EMAT Road Test/exp_14
[00:37.20] MainProcess/INFO: 2 cases completed
[00:37.20] MainProcess/INFO: experiments finished
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>alpha</th>
      <th>beta</th>
      <th>input_flow</th>
      <th>value_of_time</th>
      <th>unit_cost_expansion</th>
      <th>interest_rate</th>
      <th>yield_curve</th>
      <th>expand_capacity</th>
      <th>amortization_period</th>
      <th>debt_type</th>
      <th>interest_rate_lock</th>
      <th>free_flow_time</th>
      <th>initial_capacity</th>
      <th>no_build_travel_time</th>
      <th>build_travel_time</th>
      <th>time_savings</th>
      <th>value_of_time_savings</th>
      <th>net_benefits</th>
      <th>cost_of_capacity_expansion</th>
      <th>present_cost_expansion</th>
    </tr>
    <tr>
      <th>experiment</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10</th>
      <td>0.114450</td>
      <td>3.648104</td>
      <td>100</td>
      <td>0.034746</td>
      <td>120.196432</td>
      <td>0.028321</td>
      <td>0.001514</td>
      <td>5.621927</td>
      <td>34</td>
      <td>Paygo</td>
      <td>True</td>
      <td>60</td>
      <td>100</td>
      <td>66.867014</td>
      <td>65.624845</td>
      <td>1.242169</td>
      <td>4.316063</td>
      <td>-17.502784</td>
      <td>21.818848</td>
      <td>675.735529</td>
    </tr>
    <tr>
      <th>14</th>
      <td>0.132514</td>
      <td>4.016263</td>
      <td>133</td>
      <td>0.107612</td>
      <td>131.922290</td>
      <td>0.035993</td>
      <td>0.015811</td>
      <td>54.081760</td>
      <td>22</td>
      <td>Paygo</td>
      <td>False</td>
      <td>60</td>
      <td>100</td>
      <td>84.993873</td>
      <td>64.403269</td>
      <td>20.590604</td>
      <td>294.700221</td>
      <td>-37.110353</td>
      <td>331.810575</td>
      <td>7134.589600</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Because we have linked the second model instance back to the same database, after these experiments have finished we can access the results from the original <code class="docutils literal notranslate"><span class="pre">fx</span></code> instance.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fx</span><span class="o">.</span><span class="n">read_experiment_measures</span><span class="p">(</span><span class="s1">&#39;lhs_2&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>no_build_travel_time</th>
      <th>build_travel_time</th>
      <th>time_savings</th>
      <th>value_of_time_savings</th>
      <th>net_benefits</th>
      <th>cost_of_capacity_expansion</th>
      <th>present_cost_expansion</th>
    </tr>
    <tr>
      <th>experiment</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10</th>
      <td>66.867014</td>
      <td>65.624845</td>
      <td>1.242169</td>
      <td>4.316063</td>
      <td>-17.502784</td>
      <td>21.818848</td>
      <td>675.735529</td>
    </tr>
    <tr>
      <th>14</th>
      <td>84.993873</td>
      <td>64.403269</td>
      <td>20.590604</td>
      <td>294.700221</td>
      <td>-37.110353</td>
      <td>331.810575</td>
      <td>7134.589600</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>It is important to note that for this manual multiprocessing technique to work, where different processes run the model simultaneously, each process must be in a seperate Python instance (e.g.&nbsp;in seperate Jupyter notebooks, not in the same notebook as shown here).</p>
</div>
<div class="section" id="Automatic-Multiprocessing-for-Running-Multiple-Experiments">
<h3>Automatic Multiprocessing for Running Multiple Experiments<a class="headerlink" href="#Automatic-Multiprocessing-for-Running-Multiple-Experiments" title="Permalink to this headline">¶</a></h3>
<p>The examples above are all essentially single-process demonstrations of using TMIP-EMAT to run core model experiments, either by running all in one single process, or by having a user manually instantiate a number of single processes. If your core model itself is multi-threaded or otherwise is designed to make full use of your multi-core CPU, or if a single core model run will otherwise max out some computational resource (e.g.&nbsp;RAM, disk space) then single process operation should be sufficient.</p>
<p>If, on the other hand, your model is such that you can run multiple independent instances of the model side-by-side on the same machine, but you don’t want to manage the process of manually, then you could benefit from a multiprocessing approach that uses the <code class="docutils literal notranslate"><span class="pre">dask.distributed</span></code> library. To demonstrate this, we’ll create yet another small design of experiments to run.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">design3</span> <span class="o">=</span> <span class="n">fx</span><span class="o">.</span><span class="n">design_experiments</span><span class="p">(</span><span class="n">design_name</span><span class="o">=</span><span class="s1">&#39;lhs_3&#39;</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">design3</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>alpha</th>
      <th>amortization_period</th>
      <th>beta</th>
      <th>debt_type</th>
      <th>expand_capacity</th>
      <th>input_flow</th>
      <th>interest_rate</th>
      <th>interest_rate_lock</th>
      <th>unit_cost_expansion</th>
      <th>value_of_time</th>
      <th>yield_curve</th>
      <th>free_flow_time</th>
      <th>initial_capacity</th>
    </tr>
    <tr>
      <th>experiment</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>18</th>
      <td>0.169616</td>
      <td>35</td>
      <td>4.064396</td>
      <td>Paygo</td>
      <td>26.090367</td>
      <td>101</td>
      <td>0.034895</td>
      <td>True</td>
      <td>140.210575</td>
      <td>0.065729</td>
      <td>0.000300</td>
      <td>60</td>
      <td>100</td>
    </tr>
    <tr>
      <th>19</th>
      <td>0.192963</td>
      <td>46</td>
      <td>4.973266</td>
      <td>GO Bond</td>
      <td>56.044819</td>
      <td>107</td>
      <td>0.027205</td>
      <td>False</td>
      <td>96.267985</td>
      <td>0.077641</td>
      <td>0.015375</td>
      <td>60</td>
      <td>100</td>
    </tr>
    <tr>
      <th>20</th>
      <td>0.150234</td>
      <td>31</td>
      <td>5.429606</td>
      <td>Rev Bond</td>
      <td>42.027203</td>
      <td>135</td>
      <td>0.030607</td>
      <td>False</td>
      <td>107.239601</td>
      <td>0.115429</td>
      <td>0.004664</td>
      <td>60</td>
      <td>100</td>
    </tr>
    <tr>
      <th>21</th>
      <td>0.175508</td>
      <td>38</td>
      <td>4.505154</td>
      <td>Rev Bond</td>
      <td>21.346083</td>
      <td>124</td>
      <td>0.039424</td>
      <td>True</td>
      <td>118.538455</td>
      <td>0.014103</td>
      <td>0.012946</td>
      <td>60</td>
      <td>100</td>
    </tr>
    <tr>
      <th>22</th>
      <td>0.140599</td>
      <td>21</td>
      <td>5.035679</td>
      <td>GO Bond</td>
      <td>84.334328</td>
      <td>82</td>
      <td>0.026410</td>
      <td>True</td>
      <td>133.676568</td>
      <td>0.149598</td>
      <td>0.017552</td>
      <td>60</td>
      <td>100</td>
    </tr>
    <tr>
      <th>23</th>
      <td>0.113669</td>
      <td>25</td>
      <td>3.831327</td>
      <td>Paygo</td>
      <td>71.138662</td>
      <td>148</td>
      <td>0.036468</td>
      <td>False</td>
      <td>129.183633</td>
      <td>0.056610</td>
      <td>0.008356</td>
      <td>60</td>
      <td>100</td>
    </tr>
    <tr>
      <th>24</th>
      <td>0.108685</td>
      <td>18</td>
      <td>4.452232</td>
      <td>GO Bond</td>
      <td>8.614755</td>
      <td>130</td>
      <td>0.030786</td>
      <td>False</td>
      <td>123.140814</td>
      <td>0.092145</td>
      <td>0.000927</td>
      <td>60</td>
      <td>100</td>
    </tr>
    <tr>
      <th>25</th>
      <td>0.126817</td>
      <td>43</td>
      <td>3.599748</td>
      <td>Rev Bond</td>
      <td>92.170002</td>
      <td>95</td>
      <td>0.033748</td>
      <td>True</td>
      <td>108.577268</td>
      <td>0.128863</td>
      <td>0.011068</td>
      <td>60</td>
      <td>100</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>The demo module is set up to facilitate distributed multiprocessing. During the <code class="docutils literal notranslate"><span class="pre">setup</span></code> step, the code detects if it is being run in a distributed “worker” environment instead of in a normal Python environment. If the “worker” environment is detected, then a copy of the entire files-based model is made into the worker’s local workspace, and the model is run there instead of in the master workspace. This allows each worker to edit the files independently and simultaneously, without disturbing
other parallel workers.</p>
<p>With this small modification, we are ready to run this demo model in parallel subprocesses. to do, we simply import the <code class="docutils literal notranslate"><span class="pre">get_client</span></code> function, and use that for the <code class="docutils literal notranslate"><span class="pre">evaluator</span></code> argument in the <code class="docutils literal notranslate"><span class="pre">run_experiments</span></code> method.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">emat.util.distributed</span> <span class="kn">import</span> <span class="n">get_client</span> <span class="c1"># for multi-process operation</span>
<span class="n">fx</span><span class="o">.</span><span class="n">run_experiments</span><span class="p">(</span><span class="n">design</span><span class="o">=</span><span class="n">design3</span><span class="p">,</span> <span class="n">evaluator</span><span class="o">=</span><span class="n">get_client</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
[00:40.81] MainProcess/INFO: performing 8 scenarios/policies * 1 model(s) = 8 experiments
[00:44.10] MainProcess/INFO: 1 cases completed
[00:44.14] MainProcess/INFO: 2 cases completed
[00:44.15] MainProcess/INFO: 3 cases completed
[00:44.16] MainProcess/INFO: 4 cases completed
[00:47.28] MainProcess/INFO: 5 cases completed
[00:47.31] MainProcess/INFO: 6 cases completed
[00:47.35] MainProcess/INFO: 7 cases completed
[00:47.36] MainProcess/INFO: 8 cases completed
[00:47.36] MainProcess/INFO: experiments finished
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>alpha</th>
      <th>beta</th>
      <th>input_flow</th>
      <th>value_of_time</th>
      <th>unit_cost_expansion</th>
      <th>interest_rate</th>
      <th>yield_curve</th>
      <th>expand_capacity</th>
      <th>amortization_period</th>
      <th>debt_type</th>
      <th>interest_rate_lock</th>
      <th>free_flow_time</th>
      <th>initial_capacity</th>
      <th>no_build_travel_time</th>
      <th>build_travel_time</th>
      <th>time_savings</th>
      <th>value_of_time_savings</th>
      <th>net_benefits</th>
      <th>cost_of_capacity_expansion</th>
      <th>present_cost_expansion</th>
    </tr>
    <tr>
      <th>experiment</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>18</th>
      <td>0.169616</td>
      <td>4.064396</td>
      <td>101</td>
      <td>0.065729</td>
      <td>140.210575</td>
      <td>0.034895</td>
      <td>0.000300</td>
      <td>26.090367</td>
      <td>35</td>
      <td>Paygo</td>
      <td>True</td>
      <td>60</td>
      <td>100</td>
      <td>70.596998</td>
      <td>64.130206</td>
      <td>6.466792</td>
      <td>42.930410</td>
      <td>-72.685387</td>
      <td>115.615797</td>
      <td>3658.145376</td>
    </tr>
    <tr>
      <th>19</th>
      <td>0.192963</td>
      <td>4.973266</td>
      <td>107</td>
      <td>0.077641</td>
      <td>96.267985</td>
      <td>0.027205</td>
      <td>0.015375</td>
      <td>56.044819</td>
      <td>46</td>
      <td>GO Bond</td>
      <td>False</td>
      <td>60</td>
      <td>100</td>
      <td>76.209113</td>
      <td>61.772878</td>
      <td>14.436236</td>
      <td>119.930187</td>
      <td>-123.276235</td>
      <td>243.206421</td>
      <td>5395.321829</td>
    </tr>
    <tr>
      <th>20</th>
      <td>0.150234</td>
      <td>5.429606</td>
      <td>135</td>
      <td>0.115429</td>
      <td>107.239601</td>
      <td>0.030607</td>
      <td>0.004664</td>
      <td>42.027203</td>
      <td>31</td>
      <td>Rev Bond</td>
      <td>False</td>
      <td>60</td>
      <td>100</td>
      <td>105.981321</td>
      <td>66.843277</td>
      <td>39.138044</td>
      <td>609.887232</td>
      <td>370.661686</td>
      <td>239.225545</td>
      <td>4506.980463</td>
    </tr>
    <tr>
      <th>21</th>
      <td>0.175508</td>
      <td>4.505154</td>
      <td>124</td>
      <td>0.014103</td>
      <td>118.538455</td>
      <td>0.039424</td>
      <td>0.012946</td>
      <td>21.346083</td>
      <td>38</td>
      <td>Rev Bond</td>
      <td>True</td>
      <td>60</td>
      <td>100</td>
      <td>87.754086</td>
      <td>71.608550</td>
      <td>16.145536</td>
      <td>28.234915</td>
      <td>-96.044488</td>
      <td>124.279404</td>
      <td>2530.331667</td>
    </tr>
    <tr>
      <th>22</th>
      <td>0.140599</td>
      <td>5.035679</td>
      <td>82</td>
      <td>0.149598</td>
      <td>133.676568</td>
      <td>0.026410</td>
      <td>0.017552</td>
      <td>84.334328</td>
      <td>21</td>
      <td>GO Bond</td>
      <td>True</td>
      <td>60</td>
      <td>100</td>
      <td>63.105464</td>
      <td>60.142764</td>
      <td>2.962700</td>
      <td>36.343655</td>
      <td>-689.465120</td>
      <td>725.808774</td>
      <td>11273.523488</td>
    </tr>
    <tr>
      <th>23</th>
      <td>0.113669</td>
      <td>3.831327</td>
      <td>148</td>
      <td>0.056610</td>
      <td>129.183633</td>
      <td>0.036468</td>
      <td>0.008356</td>
      <td>71.138662</td>
      <td>25</td>
      <td>Paygo</td>
      <td>False</td>
      <td>60</td>
      <td>100</td>
      <td>90.628309</td>
      <td>63.909220</td>
      <td>26.719089</td>
      <td>223.859479</td>
      <td>-157.547999</td>
      <td>381.407477</td>
      <td>9189.950756</td>
    </tr>
    <tr>
      <th>24</th>
      <td>0.108685</td>
      <td>4.452232</td>
      <td>130</td>
      <td>0.092145</td>
      <td>123.140814</td>
      <td>0.030786</td>
      <td>0.000927</td>
      <td>8.614755</td>
      <td>18</td>
      <td>GO Bond</td>
      <td>False</td>
      <td>60</td>
      <td>100</td>
      <td>80.971250</td>
      <td>74.515731</td>
      <td>6.455519</td>
      <td>77.329350</td>
      <td>1.265260</td>
      <td>76.064090</td>
      <td>1060.827963</td>
    </tr>
    <tr>
      <th>25</th>
      <td>0.126817</td>
      <td>3.599748</td>
      <td>95</td>
      <td>0.128863</td>
      <td>108.577268</td>
      <td>0.033748</td>
      <td>0.011068</td>
      <td>92.170002</td>
      <td>43</td>
      <td>Rev Bond</td>
      <td>True</td>
      <td>60</td>
      <td>100</td>
      <td>66.326154</td>
      <td>60.602481</td>
      <td>5.723673</td>
      <td>70.069174</td>
      <td>-405.972848</td>
      <td>476.042022</td>
      <td>10007.566972</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
</div>
<div class="section" id="Running-without-a-Database">
<h2>Running without a Database<a class="headerlink" href="#Running-without-a-Database" title="Permalink to this headline">¶</a></h2>
<p>It is possible to use the methods from TMIP-EMAT without connecting to a database at all, although this is not recommended. The demo <code class="docutils literal notranslate"><span class="pre">RoadTestFileModel</span></code> by default creates a database for you if one is not given, but it also allows explicitly disclaiming a database by setting the <code class="docutils literal notranslate"><span class="pre">db</span></code> argument to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fx_nodb</span> <span class="o">=</span> <span class="n">core_files_demo</span><span class="o">.</span><span class="n">RoadTestFileModel</span><span class="p">(</span><span class="n">db</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
[00:47.39] MainProcess/WARNING: changing cwd to /var/folders/js/bk_dt9015j79_f6bxnc44dsr0000gp/T/tmpu0i09wc6
</pre></div></div>
</div>
<p>Without a database, the methods still work, but the data is not stored anywhere persistent. So, for example, the <code class="docutils literal notranslate"><span class="pre">design_experiments</span></code> will return a pandas DataFrame containing a design, but not store it.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">design4</span> <span class="o">=</span> <span class="n">fx_nodb</span><span class="o">.</span><span class="n">design_experiments</span><span class="p">(</span><span class="n">design_name</span><span class="o">=</span><span class="s1">&#39;lhs_4&#39;</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">design4</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>alpha</th>
      <th>amortization_period</th>
      <th>beta</th>
      <th>debt_type</th>
      <th>expand_capacity</th>
      <th>input_flow</th>
      <th>interest_rate</th>
      <th>interest_rate_lock</th>
      <th>unit_cost_expansion</th>
      <th>value_of_time</th>
      <th>yield_curve</th>
      <th>free_flow_time</th>
      <th>initial_capacity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.157469</td>
      <td>43</td>
      <td>5.352111</td>
      <td>GO Bond</td>
      <td>27.393080</td>
      <td>86</td>
      <td>0.035527</td>
      <td>False</td>
      <td>97.577951</td>
      <td>0.125910</td>
      <td>0.003238</td>
      <td>60</td>
      <td>100</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.189268</td>
      <td>40</td>
      <td>3.881977</td>
      <td>GO Bond</td>
      <td>56.222426</td>
      <td>148</td>
      <td>0.025682</td>
      <td>True</td>
      <td>141.368963</td>
      <td>0.052622</td>
      <td>-0.002455</td>
      <td>60</td>
      <td>100</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.140306</td>
      <td>50</td>
      <td>4.234393</td>
      <td>GO Bond</td>
      <td>64.780568</td>
      <td>112</td>
      <td>0.037690</td>
      <td>True</td>
      <td>131.890137</td>
      <td>0.034445</td>
      <td>0.013091</td>
      <td>60</td>
      <td>100</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.108730</td>
      <td>24</td>
      <td>4.380424</td>
      <td>Rev Bond</td>
      <td>23.979788</td>
      <td>98</td>
      <td>0.028841</td>
      <td>True</td>
      <td>126.122602</td>
      <td>0.078663</td>
      <td>0.008845</td>
      <td>60</td>
      <td>100</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.123790</td>
      <td>19</td>
      <td>4.527048</td>
      <td>Paygo</td>
      <td>5.397776</td>
      <td>115</td>
      <td>0.038331</td>
      <td>False</td>
      <td>111.397305</td>
      <td>0.071495</td>
      <td>0.002162</td>
      <td>60</td>
      <td>100</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.170412</td>
      <td>19</td>
      <td>4.789556</td>
      <td>Rev Bond</td>
      <td>85.377351</td>
      <td>134</td>
      <td>0.033783</td>
      <td>False</td>
      <td>114.269901</td>
      <td>0.090636</td>
      <td>0.018692</td>
      <td>60</td>
      <td>100</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.175064</td>
      <td>30</td>
      <td>5.136301</td>
      <td>Paygo</td>
      <td>92.709704</td>
      <td>126</td>
      <td>0.027840</td>
      <td>True</td>
      <td>105.831242</td>
      <td>0.205397</td>
      <td>0.007812</td>
      <td>60</td>
      <td>100</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.132154</td>
      <td>34</td>
      <td>3.631101</td>
      <td>Paygo</td>
      <td>48.808345</td>
      <td>96</td>
      <td>0.031697</td>
      <td>False</td>
      <td>136.741784</td>
      <td>0.112699</td>
      <td>0.015616</td>
      <td>60</td>
      <td>100</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>If you try to run these experiments by giving the design name, it will fail, because there is no database to query to convert that name into experimental parameters.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">fx_nodb</span><span class="o">.</span><span class="n">run_experiments</span><span class="p">(</span><span class="s1">&#39;lhs_4&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
    <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
[00:47.47] MainProcess/ERROR: ValueError(&#39;cannot load design &#34;lhs_4&#34;, there is no db&#39;)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">emat.examples</span> <span class="kn">import</span> <span class="n">road_test</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">_s</span><span class="p">,</span> <span class="n">_db</span><span class="p">,</span> <span class="n">_m</span> <span class="o">=</span> <span class="n">road_test</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
[00:47.51] MainProcess/INFO: running script scope.sql
[00:47.51] MainProcess/INFO: running script exp_design.sql
[00:47.51] MainProcess/INFO: running script meta_model.sql
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">_m</span><span class="o">.</span><span class="n">run_experiments</span><span class="p">(</span><span class="n">design3</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
[00:47.54] MainProcess/INFO: performing 8 scenarios/policies * 1 model(s) = 8 experiments
[00:47.55] MainProcess/INFO: performing experiments sequentially
[00:47.55] MainProcess/INFO: 1 cases completed
[00:47.56] MainProcess/INFO: 2 cases completed
[00:47.56] MainProcess/INFO: 3 cases completed
[00:47.56] MainProcess/INFO: 4 cases completed
[00:47.56] MainProcess/INFO: 5 cases completed
[00:47.56] MainProcess/INFO: 6 cases completed
[00:47.56] MainProcess/INFO: 7 cases completed
[00:47.56] MainProcess/INFO: 8 cases completed
[00:47.56] MainProcess/INFO: experiments finished
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>alpha</th>
      <th>beta</th>
      <th>input_flow</th>
      <th>value_of_time</th>
      <th>unit_cost_expansion</th>
      <th>interest_rate</th>
      <th>yield_curve</th>
      <th>expand_capacity</th>
      <th>amortization_period</th>
      <th>debt_type</th>
      <th>interest_rate_lock</th>
      <th>free_flow_time</th>
      <th>initial_capacity</th>
      <th>no_build_travel_time</th>
      <th>build_travel_time</th>
      <th>time_savings</th>
      <th>value_of_time_savings</th>
      <th>net_benefits</th>
      <th>cost_of_capacity_expansion</th>
      <th>present_cost_expansion</th>
    </tr>
    <tr>
      <th>experiment</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>18</th>
      <td>0.169616</td>
      <td>4.064396</td>
      <td>101</td>
      <td>0.065729</td>
      <td>140.210575</td>
      <td>0.034895</td>
      <td>0.000300</td>
      <td>26.090367</td>
      <td>35</td>
      <td>Paygo</td>
      <td>True</td>
      <td>60</td>
      <td>100</td>
      <td>70.596998</td>
      <td>64.130206</td>
      <td>6.466792</td>
      <td>42.930410</td>
      <td>-72.685387</td>
      <td>115.615797</td>
      <td>3658.145376</td>
    </tr>
    <tr>
      <th>19</th>
      <td>0.192963</td>
      <td>4.973266</td>
      <td>107</td>
      <td>0.077641</td>
      <td>96.267985</td>
      <td>0.027205</td>
      <td>0.015375</td>
      <td>56.044819</td>
      <td>46</td>
      <td>GO Bond</td>
      <td>False</td>
      <td>60</td>
      <td>100</td>
      <td>76.209113</td>
      <td>61.772878</td>
      <td>14.436236</td>
      <td>119.930187</td>
      <td>-131.395990</td>
      <td>251.326177</td>
      <td>5395.321829</td>
    </tr>
    <tr>
      <th>20</th>
      <td>0.150234</td>
      <td>5.429606</td>
      <td>135</td>
      <td>0.115429</td>
      <td>107.239601</td>
      <td>0.030607</td>
      <td>0.004664</td>
      <td>42.027203</td>
      <td>31</td>
      <td>Rev Bond</td>
      <td>False</td>
      <td>60</td>
      <td>100</td>
      <td>105.981321</td>
      <td>66.843277</td>
      <td>39.138044</td>
      <td>609.887232</td>
      <td>376.276926</td>
      <td>233.610306</td>
      <td>4506.980463</td>
    </tr>
    <tr>
      <th>21</th>
      <td>0.175508</td>
      <td>4.505154</td>
      <td>124</td>
      <td>0.014103</td>
      <td>118.538455</td>
      <td>0.039424</td>
      <td>0.012946</td>
      <td>21.346083</td>
      <td>38</td>
      <td>Rev Bond</td>
      <td>True</td>
      <td>60</td>
      <td>100</td>
      <td>87.754086</td>
      <td>71.608550</td>
      <td>16.145536</td>
      <td>28.234915</td>
      <td>-96.044488</td>
      <td>124.279404</td>
      <td>2530.331667</td>
    </tr>
    <tr>
      <th>22</th>
      <td>0.140599</td>
      <td>5.035679</td>
      <td>82</td>
      <td>0.149598</td>
      <td>133.676568</td>
      <td>0.026410</td>
      <td>0.017552</td>
      <td>84.334328</td>
      <td>21</td>
      <td>GO Bond</td>
      <td>True</td>
      <td>60</td>
      <td>100</td>
      <td>63.105464</td>
      <td>60.142764</td>
      <td>2.962700</td>
      <td>36.343655</td>
      <td>-689.465120</td>
      <td>725.808774</td>
      <td>11273.523488</td>
    </tr>
    <tr>
      <th>23</th>
      <td>0.113669</td>
      <td>3.831327</td>
      <td>148</td>
      <td>0.056610</td>
      <td>129.183633</td>
      <td>0.036468</td>
      <td>0.008356</td>
      <td>71.138662</td>
      <td>25</td>
      <td>Paygo</td>
      <td>False</td>
      <td>60</td>
      <td>100</td>
      <td>90.628309</td>
      <td>63.909220</td>
      <td>26.719089</td>
      <td>223.859479</td>
      <td>-155.256907</td>
      <td>379.116386</td>
      <td>9189.950756</td>
    </tr>
    <tr>
      <th>24</th>
      <td>0.108685</td>
      <td>4.452232</td>
      <td>130</td>
      <td>0.092145</td>
      <td>123.140814</td>
      <td>0.030786</td>
      <td>0.000927</td>
      <td>8.614755</td>
      <td>18</td>
      <td>GO Bond</td>
      <td>False</td>
      <td>60</td>
      <td>100</td>
      <td>80.971250</td>
      <td>74.515731</td>
      <td>6.455519</td>
      <td>77.329350</td>
      <td>1.259730</td>
      <td>76.069620</td>
      <td>1060.827963</td>
    </tr>
    <tr>
      <th>25</th>
      <td>0.126817</td>
      <td>3.599748</td>
      <td>95</td>
      <td>0.128863</td>
      <td>108.577268</td>
      <td>0.033748</td>
      <td>0.011068</td>
      <td>92.170002</td>
      <td>43</td>
      <td>Rev Bond</td>
      <td>True</td>
      <td>60</td>
      <td>100</td>
      <td>66.326154</td>
      <td>60.602481</td>
      <td>5.723673</td>
      <td>70.069174</td>
      <td>-405.972848</td>
      <td>476.042022</td>
      <td>10007.566972</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>